

## 图解 HTTP

是一本好书，HTTP原理讲的通俗易懂。 俗话说， 一张图抵得过1000个词语描述。

尤其是 HTTPS 部分，之前很多不明白的地方，现在都大概明白了。


### HTTPS

HTTP 的缺点是所有信息都是明文的，报文内容很容易被截获、篡改。

还有其他很多问题：

1. 用户不能确定请求的响应是从真实的目标服务器返回，还是从一个伪造的服务器返回。
2. 服务器不能确定请求是从真实的用户发出，还是从伪造的非法用户发出。（照单全收）

一种思路就是对通信内容加密。但是如何加密？

#### 共享密钥加密

如果报文加密、解密需要使用同一个密钥，这种加密方式成为 **共享密钥加密**，也称作 **对称密钥加密**。

客户端和服务器同时知道密钥是什么。 但是这个密钥如何传递呢？

如果在网络以不加密的方式传递这个密钥，那么也存在被截获的可能性。

#### 公钥私钥对

公钥私钥是这样一种加密方式： 令 $P$ 表示公钥， $P(x)$ 表示对 $x$ 进行加密； $S(x)$ 表示用私钥对信息 $x$ 进行加密。

公钥私钥满足这个特点：  $P(S(x)) = S(P(x)) = x$

即一个密钥加密的消息，可以用另一个密钥解开。

这样只要公开一个密钥（公钥，可以在网络公开和传递），而保管好另一个密钥（私钥，不在网络公开和传递）。

对于服务器来说，公开公钥，保存管理好私钥。 客户端使用服务器的公钥加密信息，服务器可以用私钥解密信息。

保证了的信息的安全性：如果不知道私钥，仅根据 密文以及公钥 **很难破解密文**。

但是又存在另一个问题：

如何保证公钥的合法性？ 如果伪装服务器（篡改 DNS域名），私造一个公钥私钥对， 那么客户端也不知道是不是真的服务器。


#### 服务器公钥的第三方认证

数字证书认证机构（CA，Certificate Authority）。

数字证书认证机构的业务流程

1. 服务器的运营人员 向 数字证书认证机构 登记 服务器公开密钥，申领证书。
2. 数字证书认证机构 在核实申请者的身份之后，会用自己的公钥私钥， 用私钥对申请的公开密钥做数字签名，公钥证书 = 服务器的公钥 + 数字签名。
3. 服务器会将这份公钥证书发送给客户端。
4. 接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事: 一，认证服务器的公开密钥的是真实有效的数字证书认证机构。二，服务器的公开密钥是值得信赖的。

这里有个问题是认证机构的公钥从哪里获取？使用通信方式时，如何安全转交是一件很困难的事，因此，多数浏览器开发商发布版本时，会事先在内部植入常用认证机构的公钥。

#### 混合加密方式

使用公钥私钥对方式，信息的安全性得到了保证。但是效率会比较低。

这时候考虑用 混合加密方式： 使用 公钥私钥对 传递一个 临时的共享密钥， 然后在后续的信息中，使用这个共享密钥加密。

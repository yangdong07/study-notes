主要内容：
- 线性规划
- 线性规划的标准型和松弛型
- 单纯形算法
- 主元
- 线性规划对偶性

## 线性规划问题 linear-programming problem

在给定有限的资源和竞争约束情况下，很多问题都可以表述为最大化或最小化某个目标。如果可以把目标指定为某些变量的一个线性函数，且可以将资源的约束指定为这些变量的线性等式或不等式，则得到一个**线性规划问题**。

**线性函数** $$ f(x_1, x_2, \cdots, x_n) = a_1x_1 + a_2x_2 + \cdots + a_nx_n = \sum_{j=1}^n{a_jx_j}$$
**线性等式** $$ f(x_1, x_2, \cdots, x_n) = b $$
**线性不等式** $$  f(x_1, x_2, \cdots, x_n) \le b \\  f(x_1, x_2, \cdots, x_n) \ge b $$
**线性约束** 指线性等式或线性不等式。在线性规划中，一般不允许严格的不等式（边界条件）。
**线性规划问题**： 最大化或最小化一个受限于一组有限的线性约束的线性函数。最小化线性规划和最大化线性规划。


## 线性规划标准型
已知 $n$ 个实数 $c_1, c_2, \cdots, c_n$；$m$ 个实数 $b_1, b_2, \cdots, b_n$；以及 $mn$ 个实数 $a_{ij}$，其中 $i = 1, 2, \cdots, m$，而 $j = 1, 2, \cdots, n$。我们希望找出 $n$ 个实数 $x_1, x_2, \cdots, x_n$ 来
最大化 $$ \sum_{j=1}^n{c_jx_j}$$ 满足约束
$$ \sum_{j=1}^n{a_{ij}x_j} \le b_i,  \quad i = 1, 2, \cdots, m \\ x_j \ge 0, \quad j = 1, 2, \cdots, n $$

$ \sum_{j=1}^n{c_jx_j}$ 为**目标函数**， 约束有 $n+m$ 个，包括 $n$ 个**非负性约束** 和 $m$ 个 **不等式约束**

称满足所有约束的变量 $\bar{x}$ 为**可行解**，不满足至少一个约束的变量 $\bar{x}$ 为**不可行解**。一个解 $\bar{x}$ 拥有目标值 $\boldsymbol{c}^T \bar{x}$。
在所有可行解中，目标值最大的一个可行解为 **最优解**，且称其目标值为 ** 最优目标值**。
如果一个线性规划没有可行解，则称此线性规划是 **不可行**；否则它是**可行**。
如果一个线性规划有一些可行解但没有有限的最优目标值，则称此线性规划是**无界**的。

### 将一般线性规划问题转换为标准型
一个线性规划可能由于如下4个原因之一而不是标准型：
1. 目标函数可能是一个最小化，而不是最大化
2. 可能有的变量不具有非负性约束
3. 可能有**等式约束**，即有一个等号而不是小于等于号
4. 可能有**不等式约束**，但不是小于等于号，而是一个大于等于号

可以通过以下方式转换成标准型
#### 1. 目标函数可能是一个最小化，而不是最大化
通过将目标函数的所有系数取负数，可以得到最大化问题。

#### 2. 可能有的变量不具有非负性约束
假设某个变量 $x_i$ 不具有非负性约束，把 $x_j$ 全部用 $x'_j - x''_j$ 替换，并增加非负性约束 $x'_j \ge 0$ 和 $x''_j \ge 0$
新的线性规划问题的任意可行解都可以转成原问题的可行解： $\bar{x}_j = \bar{x}'_j - \bar{x}''_j$

#### 3. 可能有**等式约束**，即有一个等号而不是小于等于号
对于一个线性等式约束，可以用两个不等式约束代替： $f(x_1, x_2, \cdots, x_n) = b  \Leftrightarrow f(x_1, x_2, \cdots, x_n) \le b \ and \  f(x_1, x_2, \cdots, x_n) \ge b $

#### 4. 可能有**不等式约束**，但不是小于等于号，而是一个大于等于号
将 $f(x_1, x_2, \cdots, x_n) \ge b$ 两边同时乘以$-1$，可得到一个小于等于的约束。

## 线性规划松弛型
对于某个不等式约束 $$ \sum_{j=1}^n{a_{ij}x_j} \le b$$， 引入一个新的变量 $s$ ，可以使之变成两个约束：
$$ s = b_i - \sum_{j=1}^n{a_{ij}x_j} \\ s \ge 0 $$ 一个等式约束和一个非负性约束。
称 $s$ 是一个**松弛变量（slack variable）**。

对标准型线性规划，引入 $m$ 个变量， 可以将其 $m$ 个不等式约束，转换成 $m$个等式约束和 $m$ 个非负性约束：
$$ x_{n+i} = b_i - \sum_{j=1}^n{a_{ij}x_j}  \\ x_{n+i} \ge 0 \quad i = 1, 2, \cdots, m $$
由这种若干等式约束和非负性约束构成的线性规划 为**松弛型**。
等式约束左边出现的变量称为 **基本变量**；等式约束右边出现的变量称为 **非基本变量**。非基本变量也出现在目标函数中。

在单纯形算法中，会不断改变基本变量和非基本变量。
用 $\boldsymbol{N}$ 表示非基本变量下标的集合； 用 $\boldsymbol{B}$ 来表示基本变量下标的集合。松弛型线性规划定义为：
$$ 目标函数： z = v + \sum_{j\in N}{c_jx_j} \\ 等式约束： x_i = b_i - \sum_{j\in N}{a_{ij}x_j}  \quad \text{for } i \in B \\ x_i \ge 0 \quad \text{for } i \in B \cup N $$
注意到目标函数也是由非基本变量得到。

## 单纯形算法
单纯形算法的主要思想：
- 将每个非基本变量设为0，并从等式约束中计算基本变量的值，可以得到一个“基本解”。
- 每次迭代将一个松弛型转换成一个等价的松弛型。相应的基本可行解的目标值不小于前一次迭代中的目标值（通常是大于）
- 每次迭代通过选择一个非基本变量，使得目标函数是该非基本变量$x_e$的单调增函数（也就是系数$c_e \ge 0$），然后“增大”这个变量的值，使得某个等式约束中基本变量$x_l$最先变为0。将 $x_e$ 全部用 $x_l$ 表示，令其变成基本变量。令 $x_l$ 成为非基本变量，改写线性规划的松弛型。新的目标函数由新的非基本变量得到。将每个非基本变量设为0，可以得到一个新的基本解和目标值。
- 一个基本解总是对应于单纯形的一个顶点。**单纯形 （simplex）**可以理解成 $n$ 维空间中的可行区域。这个可行区域是凸的，最优解可以在某一个顶点上获得。

每次迭代选择非基本变量的操作称为**主元（pivot）**。 $x_e$ 称为**换入变量**； $x_l$ 称为**换出变量**。

单纯形算法主要由三部分组成：
1. 主元（非基本变量换入换出）
2. 单纯形算法：从一个基本解可行的松弛型开始，迭代找出最优解。或者判断出线性规划是无界的。
3. 初始基本可行解：对可行线性规划的某个松弛型，基本解（令非基本变量为0）并不一定是一个可行解。可以通过一个**辅助线性规划**找到一个基本解可行的松弛型，或者判断出线性规划是不可行的。

### 1. 主元 Pivot
主元操作是单纯形算法的一个子过程。给定换入变量下标$e$ 和换出变量下标 $l$ ，主元可以将松弛型转成一个等价的松弛型。
令输入为 $(\boldsymbol{N}, \boldsymbol{B}, \boldsymbol{A}, \boldsymbol{b}, \boldsymbol{c}, v, l, e)$，输出为 $(\hat{\boldsymbol{N}}, \hat{\boldsymbol{B}}, \hat{\boldsymbol{A}}, \hat{\boldsymbol{b}}, \hat{\boldsymbol{c}}, \hat{v})$
主要有以下计算：
$$
\because \  x_i = b_i - \sum_{j\in N}{a_{ij}x_j}, \quad z = v + \sum_{j \in N}{c_jx_j}  \\
\ x_e = \frac{b_l}{a_{le}} - \sum_{j \in N - \{e\}}{\frac{a_{lj}}{a_{le}}x_j} - \frac{1}{a_{le}} x_l\\
\hat{b}_e = \frac{b_l}{a_{le}},  \quad \hat{a}_{ej} = \frac{a_{lj}}{a_{le}}  \quad  \text{for  } j \in N - \{e \}, \quad \hat{a}_{el} = \frac{1}{a_{le}} x_l \\
\hat{b}_i = b_i - a_{ie}\hat{b}_e,  \quad \hat{a}_{ij} = a_{ij} - a_{ie}\hat{a}_{ej} \quad   \text{for  } i \in B - \{l \}, j \in N - \{e \} \\
\hat{v} = v + c_e\hat{b}_e,  \quad \hat{c}_j = c_j - c_e \hat{a}_{ej}  \quad  \text{for  } j \in N - \{e \} \\
\hat{\boldsymbol{N}} = \boldsymbol{N} - \{e\} \cup \{l \} \\
\hat{\boldsymbol{B}} = \boldsymbol{B} - \{l\} \cup \{e \}
$$

在主元操作中，关键是选择一个 $a_{le}$ 使得  $a_{le}$ 非零。更强的条件需要 $c_e > 0$，并且 $a_{le}>0$。

### 2. 单纯形 Simplex
单纯形的主要过程假设从一个基本解可行的松弛型开始，递归的调用主元。
1. 循环条件， 总是有某个 $j \in N$ ，有 $c_j > 0$ 否则终止循环
2. 循环内： 选择 一个 $c_e > 0$
3. 对所有的 $i \in B$，如果 有 $a_{ie} > 0$，计算 $\Delta_{i} = b_i / a_{ie}$，对最小的 $\Delta{i}$，令 $l = i$。如果 $\Delta{l} = \infty$，则这个线性规划是无界的，退出。
4. 否则对 $(l, e)$ 进行主元操作。
5. 循环终止时，对所有的 $j \in N$，有 $c_j \le 0$，此时令 $x_j = 0$，$x_i = b_i$，可以得到一个基本解，和目标值 $v$。

可以证明： **单纯形过程的每个循环得到的松弛型都是等价的，其相关的基本解都是可行的（满足约束条件）**

注意一个线性规划的松弛型总共有 ${n + m}\choose{m}$ 个（从 $n+m$ 个变量中选择 $m$ 个作为基本变量）。所以单纯形过程至多有 ${n + m}\choose{m}$ 次迭代。如果超过 ${n + m}\choose{m}$ 次迭代，则它是循环的。循环在理论上是可能的，但是非常罕见。小心地选择换入变量和换出变量可以避免其发生，以下是一些策略：
1. 稍微扰动输入，使得不可能有两个解的目标值相等
2. 按字典顺序打破一样的目标值
3. 通过总是选择具有最小下标的变量来打破这种相等的局面
4. Bland规则。。。

对于单纯形过程，还需要证明： **循环终止时，单纯形过程要么得到一个无界的结果，要么得到一个最优解**。

这个证明需要引入**线性规划对偶性（linear programming dulity）** 的概念。
最大流最小割就是具有对偶性质：一个最大流对应一个最小割。给定一个目标最大化的线性规划问题，构造一个对偶线性规划，使其目标最小化，并且原问题的最优解的值与对偶线性规划问题的最优解的值相等。

给定一个标准型的原线性规划（primal），定义其对偶线性规划为
最小化 $$ \sum_{i=1}^m{b_i y_i}$$ 满足约束 $$ \sum_{i=1}^m{a_{ij}y_i} \ge c_j, \quad j = 1, 2, \cdots, n \\ y_i \ge 0, \quad i = 1, 2, \cdots, m $$
与primal不一样的地方是： $m$ 个变量和非负性约束；目标函数最小化，且系数为原线性规划的约束值； $n$ 个不等式约束，且约束值为原线性规划的目标函数系数。
可以证明： **primal的任意一个可行解 $\bar{x}$的目标值，都不大于dulity的任意一个可行解 $\bar{y}$ 的目标值，即 $$ \sum_{j=1}^n{c_j\bar{x}_j} \le \sum_{i=1}^m{b_i\bar{y}_i}$$**
**如果 $$ \sum_{j=1}^n{c_j\bar{x}_j} = \sum_{i=1}^m{b_i\bar{y}_i} $$ 则 $\bar{x}$ 和 $\bar{y}$分别 是primal和dulity线性规划的最优解。**

在单纯形过程中，假设最终得到了一个松弛型为 $$ z = v' + \sum_{j\in N}{c'_jx_j} \quad x_i = b'_i - \sum_{j \in N}{a'_{ij}x_j}  \quad  \text{when} \ i \in B$$
则一个对偶解是设定：
$$ \bar{y}_i = \left\{ \begin{array} {l}
-c’_{n+i}  \quad if \ (n+i) \in N \\
0 \qquad \quad else
\end{array} \right . $$
这个式子不是很好理解。
- 考虑原线性规划的第一个松弛型中也出现了 $x_{n+i} = b_i - \sum_{j=1}^n{a_{ij}x_j} $，对 $m$ 个不等式约束，有 $m$ 个基本变量
- 这里对偶线性规划中，有 $m$ 个变量， $\bar{y}$ 有 $m$ 个非负值（因为循环的最终条件是所有 $c'_j \le 0$）
- 可以证明，**这里的 $\bar{y}$ 是对偶线性规划的一个可行解，同时 $$v' = \sum_{j=1}^n{c_j\bar{x}_j} = \sum_{i=1}^m{b_i\bar{y}_i} $$ ，$\bar{y}$ 也是对偶线性规划的一个最优解。**
- 可以证明，**由 单纯形过程给出的最终的松弛型的目标值为 $v'$，同时也是原线性规划的最优解**.

### 初始基本可行解
有时候，一个线性规划的最初松弛型的基本解不一定是可行的，或者线性规划是不可行的。可以通过构造一个**辅助线性规划**来判断原线性规划是否可行，如果可行，给出一个具有可行基本解的松弛型。
设$L$ 是一个标准型的线性规划，构造一个辅助线性规划 $L_{aux}$ ：具有 $n+1$ 个变量，
最大化 $$ -x_0 $$ 满足约束 $$ \sum_{j=1}^n{a_{ij}x_j} - x_0 \le b_i \quad \text{for} \ i = 1, 2, \cdots, m\\
x_j \ge 0 \quad \text{for} \ j = 0, 1, \cdots, n$$
辅助线性规划 $L_{aux}$具有以下性质： **当且仅当 $L_{aux}$ 的最优目标值为0时， $L$ 是可行的。**

初始基本可行解的基本步骤：
1. 令 $b_k = \min\{b_i\}$, 如果 $b_k \ge 0$ ，说明所有 $b_i$都非负，原线性规划的第一个松弛型的基本解可行。否则，基本解不可行（因为有 $x_k = b_k < 0$ 不满足非负约束）
2. 构造$L$的辅助线性规划， 令 $l = n + k$，令 $x_0$ 为换入变量， $x_l$ 为换出变量，调用主元过程，得到$L_{aux}$ 的一个松弛型，可以证明，**这个松弛型的基本解是可行的**。
3. 在此基础上使用单纯形的迭代，找出 $L_{aux}$ 的最优解，如果最优解的目标值 $-x_0 = 0$，对$L_{aux}$ 的松弛型，令 $\bar{x}_0 = 0$，代入可得到 $L$ 的松弛型，且具有可行基本解。否则，$L$ 是不可行的。


**综上，以标准型给出的任意的线性规划$L$ 可以是以下三者之一 **：
1. 有一个有限目标值的最优解
2. 不可行
3. 无界

**单纯形算法可以得到正确的结果**

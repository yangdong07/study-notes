

## 流网络

**流网络**$G = (V, E)$ 是一个有向图，其中每条边 $(u, v) \in E$ 均有一个非负容量 $c(u, v) \ge 0$。如果 $(u, v) \notin E$，则假定 $c(u, v) = 0$。流网络中有两个特别的顶点：源点 $s$ 和 汇点 $t$。为了方便起见，假定每个顶点均处于从 $s$ 到 $t$ 的某条路径上。因此，图$G$ 是连通图，且 $|E| \ge |V| - 1$。

**流**
$G$ 的流 是一个实值函数 $f: V \times V \to \boldsymbol{R}$，且满足以下三个性质：
- **容量限制**： 对所有 $u, v \in V$，$f(u, v) \le c(u, v)$
- **反对称性**： 对所有 $u, v \in V$，$f(u, v) = -f(v, u)$
- **流守恒性**： 对所有 $u \in V - \{s, t\}$，有 $$ \sum_{v \in V}{f(u, v)} = 0$$ 流的守恒性的意思是，除了源点和汇点，其他所有点的流入和流出是相同的，不会有积累。

$f(u, v)$ 称为从 $u$ 到$v$ 的流。 流 $f$ 的值定义为： $|f| = \sum_{v\in V}{f(s,v)}$，即所有从源点出发到其它点的总流之和。

### 具有多个源点和多个汇点的网络
可以通过添加一个**超级源点** 和一个**超级汇点**来解决。超级源点连接所有源点，并且边的容量无限；超级汇点连接所有汇点，边的容量无限。
问题归结为单源点和单汇点问题。

### 流的性质
**隐含求和记号**
对流函数 $f$ ，如果变量是一个集合，则隐含着对集合中所有的点求和。例如如果 $X$ 和 $Y$ 是顶点的集合，则：$$f(X, Y) = \sum_{x\in X}{\sum_{y\in Y}{f(x, y)}}$$

流网络的某个流 $f$ 具有如下性质：
- 对所有 $X, Y \subseteq V$， $f(X, Y) = -f(Y, X)$（由 $f(u,v) = -f(v, u)$可知）
- 对所有 $X \subseteq V$，$f(X, X) = 0$。（由$f(X, X) = -f(X, X)$可知）
- 对所有 $X, Y, Z \subseteq V$，其中 $X \cap Y = \emptyset$，有 $f(X \cup Y, Z) = f(X, Z) + f(Y, Z)$ 且 $f(Z, X \cup Y) = f(Z, X) + f(Z, Y)$

使用隐含求和记号，流值 $|f| = f(s, V) = f(V, t)$

### 最大流问题
给定一个流网络 $G=(V, E)$，给出一个具有最大流值的流的解。

## Ford-Fulkerson方法
一种迭代方法，通过迭代增加流的值，来找到最大流。
会引入几个概念：残留网络（residual network），增广路径（augmenting path）和割（cut）

### 残留网络 residual network
残留网络是在流 $f$ 上定义的。给定一个流网络 $G=(V, E)$ 和一个流 $f$，定义每对顶点之间的**残留容量（residual capacity）** $c_f(u,v) = c(u, v) - f(u, v)$。

注意 残留容量 有以下性质：
1. $c_f(u,v)$ 总是非负的。因为 $f(u, v) \le c(u, v)$
2. 如果 $f(u, v)$ 是负的，表示 $f(v, u)$ 是正的，即使$(u, v) \notin E$，$c(u, v) = 0$，也能得到 $c_f(u, v) = f(v, u) > 0$

定义$G$和流$f$ 的残留网络为 $G_f = (V, E_f)$，其中 $$ E_f = \{ (u, v) \in V \times V: c_f(u, v) > 0 \}$$

对残留网络来说，有可能比原流网络多一些边，但不会多于源流网络边数的两倍： $|E_f| \le 2|E|$

设 $f'$ 是 残留网络 $G_f$ 中的一个流。定义 $(f + f')(u, v) = f(u, v) + f'(u, v)$ ， $f + f'$ 是 $G$ 中的一个流，并且有 $|f + f'| = |f| + |f'| $。 图 $G$ 的流 $f$ 可以通过其残留网络中的流 $f'$ 增加。

### 增广路径 augmenting path
已知一个流网络 $G=(V, E)$和流 $f$， 增广路径 $p$ 是残留网络中从 $s$ 到 $t$ 的一条简单路径。
根据残留网络的定义，在不违反容量限制的条件下，增广路径上可以容纳一个正网络流。
定义增广路径$p$ 的残留容量：$$ c_f(p) = \min{\{c_f(u, v): (u, v) \ in \ p \}}$$ 即通路上每条边上的最小残留容量。

定义基于增广路径 $p$ 残留容量的流 $f_p$ 为 ：
$$ f_p(u, v) = \left\{ \begin{array} {l}
c_f(p)   \quad if \ (u, v) \ in \ p \\
-c_f(p)  \quad if \ (v, u) \ in \ p \\
0 \quad else
\end{array} \right .$$ 符合流性质。
该流的流值 $|f_p| = c_f(p) > 0$， 是残留网络上的一个流，可以添加到流 $f$ 上去： $|f+f_p| = |f|+|f_p| > |f|$

### 流网络的割 cut
流网络 $G=(V, E)$ 的割 $(S, T)$ 将 $V$ 划分为 $S$ 和 $T = V - S$ 两部分，使得 $s \in S, t \in T$。
如果 $f$ 是一个流，则$f(S, T)$ 是穿过割 $(S, T)$ 的**净流**。割 $(S, T)$ 的容量为 $c(S, T)$。
一个流网络的最小割也就是网络中所有割中具有最小容量的割。

**穿过任意割的净流都是相同的，并且与流值相等**：对任意割 $(S, T)$ 和任意流 $f$，有 $f(S, T) = |f|$
**对于流网络的任意流 $f$，其值的上界为$G$ 的任意割的容量** $$ |f| = f(S, T) \le c(S, T)$$

**最大流最小割定理**：以下条件等价：
1. $f$ 是$G$的一个最大流
2. 残留网络 $G_f$ 不包含增广路径
3. 对 $G$ 的某个割 $(S, T)$，有 $|f| = c(S, T)$

**最大流值 = 最小割的容量**


### 基本的Ford-Fulkerson算法

基本步骤：
1. 初始化流 $f = 0$
2. 从 $G_f$ 中找到增广路径，计算 $c_f(p)$，添加到 $f$ 中
3. 循环第2步，直到找不出增广路径

实际中碰到的最大流问题，其容量常为整数；如果是有理数，也可以按比例变成整数。
步骤中的关键是如何找出增广路径。如果使用 BFS 来选择增广路径，需要 $O(E)$ 时间。如果最大流的值为 $|f^* |$， 则最多需要 $O(E|f^* |)$ 时间，因为每次迭代中，流的值至少增加一个单位，最多迭代 $|f^* |$次。

### Edmonds-Karp算法
Edmonds-Karp算法是 Ford-Fulkerson方法的一个实现。在选择增广路径时，该算法的策略是通过 BFS 找出 $s$ 到 $t$ 的最短路径（其中每条边为单位距离）。

算法在运行过程中，每次选择了最短路径，都会移出一条具有残留容量$c_f(p)$ 的关键边。可以证明 $|E|$ 条边中的每一条都可能至多 $|V| /2 -1 $ 次成为关键边。所以算法的迭代次数为 $O(EV)$，运行时间为 $O(VE^2)$

_压入和重标记算法可以达到更好的界： $O(V^2E)$ 和 $O(V^3)$_


## 最大二分匹配

**匹配**定义： 给定一个无向图 $G=(V, E)$，一个**匹配（matching）**是边的一个子集 $M \subseteq E$，满足对所有顶点 $v \in V$，$M$ 中至多有一条边与 $v$ 关联。
如果 $M$ 中某条边与 $v$ 关联，则说顶点 $v \in V$ 被匹配，否则说 $v$ 是无匹配的。
具有最多匹配的 $M$ 称为最大匹配。

**二分图**：顶点集合可以划分为 $V = L \cup R$，其中 $L$ 和 $R$是不相交的。且对任意 $(u, v) \in E$， 有$u \in L, v \in R$。

**最大二分匹配问题**：在二分图中寻找最大二分匹配。

二分图有一些实际应用，比如机器集合 $L$ 和任务集合 $R$，边 $(u, v)$说明机器 $u$ 可以完成任务 $v$。找出最大匹配可以为尽可能多的机器提供任务。

### 寻找最大二分匹配
定义二分图 $G$的流网络 $G' = (V', E')$，增加一个源点$s$ 和一个汇点 $t$，$V' = V \cup \{s, t\}$
$$ E' = \{(s, u): u\in L\} \cup \{(v, t) : v \in R\} \cup E $$ 定义 $c(u, v) = 1$，即每条边具有单位容量。
可以描述成：从 $s$ 出发到每个$L$ 的点，所有$R$的点最后进入 $t$。

对这样的流网络找出最大流 $f$，即可得到最大匹配 $M$。
